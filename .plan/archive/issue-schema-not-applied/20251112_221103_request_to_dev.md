**Important: Read `README.md` first to understand your role and workflow before starting this assignment.**

**Lifecycle Folder:** issue-schema-not-applied

**Requirements:** See `.lifecycle/issue-schema-not-applied/requirements.md` for detailed specifications

## Assignment: Implement Database Migration Strategy

### Context

The Review team has identified the root cause of the "no such table: folders" error. This is NOT a missing file issue - it's a schema migration problem.

**Root Cause:**
The database file contains an old schema (before commit 2797340 which added the `folders` table). The current Database.swift initialization logic (lines 45-48) only checks if the `items` table exists. If it does, schema creation is skipped entirely, preventing new tables from being created during app updates.

**Current flawed logic:**
```swift
let tableExists = try db.tableExists("items")
if !tableExists {
    try db.execute(sql: schema)
}
```

This assumes if `items` exists, ALL tables exist - which breaks when new tables are added to the schema.

### Your Development Tasks

Review team recommends implementing one of these approaches:

**Option 1: Quick Fix for Development (Recommended for now)**

Since this is still in development phase, implement a comprehensive table check:

1. Check for ALL required tables: `folders`, `items`, `tags`, `notes`, `item_tags`
2. If ANY table is missing:
   - Drop all existing tables
   - Execute schema.sql to recreate everything fresh
3. This is acceptable for development but would need migration logic for production

**Option 2: Production-Grade Migration (For future consideration)**

Implement GRDB's DatabaseMigrator:
- Each schema change gets a versioned migration
- GRDB tracks which migrations have been applied
- Safer for production but more complex for current development phase

### Implementation Requirements

**State Space Considerations:**
- First launch (no database file): Create fresh schema
- Existing database with old schema: Detect and migrate
- Existing database with current schema: No action needed
- Corrupted database: Handle gracefully (drop and recreate)

**Edge Cases:**
- What if schema.sql is malformed?
- What if dropping tables fails?
- What if some tables exist but others don't?

### Logging Requirements

The Review team noted that Database.swift uses `print()` instead of `NSLog()`, making debugging difficult. While implementing the migration logic:

1. Convert ALL `print()` statements in Database.swift to `NSLog()` for consistency with the rest of the codebase
2. Add diagnostic logging for:
   - Which tables are found/missing
   - Whether migration is needed
   - Migration success/failure

### Expected Deliverables

**Status:** COMPLETE / BLOCKED / NEEDS CLARIFICATION

**Implementation Details:**
[Describe what approach you chose and why]

**Changes Made:**
[List of files modified and what was changed]

**Testing Performed:**
[How did you verify the fix works? Test both fresh install and upgrade scenarios]

**Edge Cases Handled:**
[How does your implementation handle the edge cases listed above?]

**Next Steps:**
[Should this go to Review for code review, or are there blockers?]

**When completing this work, include a reminder in your response.md for the recipient to read their README.md as crucial process requirements are documented there.**
