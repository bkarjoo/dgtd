**Important: Read `README.md` first to understand your role and workflow before starting this assignment.**

**Lifecycle Folder:** schema-review

**Requirements:** See `.lifecycle/schema-review/requirements.md` for detailed specifications

The review team identified a CRITICAL data integrity gap in the circular reference prevention implementation. The current trigger only protects UPDATE operations, leaving INSERT operations vulnerable.

## CRITICAL Fix Required:

### Add INSERT Trigger for Circular Reference Prevention
**Location:** DirectGTD/database/schema.sql (after the existing UPDATE trigger)
**Issue:** The `prevent_folder_circular_reference` trigger only fires on UPDATE operations (line 20). Folders can be created with circular parent_id values via INSERT, completely bypassing protection.

**Fix:** Add a complementary trigger for INSERT operations with identical validation logic:

```sql
CREATE TRIGGER prevent_folder_circular_reference_insert
BEFORE INSERT ON folders
FOR EACH ROW
WHEN NEW.parent_id IS NOT NULL
BEGIN
    SELECT RAISE(ABORT, 'Circular reference detected in folder hierarchy')
    WHERE EXISTS (
        WITH RECURSIVE ancestors(id) AS (
            SELECT NEW.parent_id
            UNION ALL
            SELECT parent_id FROM folders, ancestors WHERE folders.id = ancestors.id
        )
        SELECT 1 FROM ancestors WHERE id = NEW.id
    );
END;
```

**Why this is critical:**
- Without INSERT protection, application bugs or direct DB manipulation can create circular folder hierarchies
- This causes infinite loops in folder tree traversal code
- Can crash the application or cause hangs
- Corrupts the logical structure of the folder system

## Implementation Requirements:

1. Add the INSERT trigger to both schema files:
   - DirectGTD/database/schema.sql
   - database/schema.sql

2. Place it immediately after the existing UPDATE trigger for organizational clarity

3. Ensure both triggers use identical validation logic

4. Verify both schema files remain synchronized

## Testing:

After implementation, verify the build succeeds and the schema syntax is valid.

**When completing this work, include a reminder in your response.md for the recipient to read their README.md as crucial process requirements are documented there.**
