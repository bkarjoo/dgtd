**Important: Read `README.md` first to understand your role and workflow before starting this assignment.**

**Lifecycle Folder:** schema-review

**Requirements:** See `.lifecycle/schema-review/requirements.md` for detailed specifications

The review team has identified critical schema issues that need to be fixed. Please implement the following HIGH PRIORITY fixes:

## HIGH PRIORITY Fixes Required:

### 1. Fix Schema Inconsistency
**Location:** database/schema.sql:73-79
**Issue:** Missing indexes that exist in DirectGTD/database/schema.sql
**Fix:** Add the following missing indexes to database/schema.sql:
```sql
CREATE INDEX idx_folders_parent_id ON folders(parent_id);
CREATE INDEX idx_folders_sort_order ON folders(sort_order);
```

### 2. Add Circular Reference Prevention
**Location:** DirectGTD/database/schema.sql:15
**Issue:** No circular reference prevention for folder hierarchy
**Fix:** Add a trigger to prevent circular references in the folders table. A folder should never be able to become its own ancestor through a chain of parent_id references.

### 3. Add Status Field CHECK Constraint
**Location:** DirectGTD/database/schema.sql:28
**Issue:** Status field lacks CHECK constraint
**Fix:** Modify the status field definition to:
```sql
status TEXT DEFAULT 'next_action' CHECK(status IN ('next_action', 'waiting', 'someday', 'completed'))
```

### 4. Add Energy Level CHECK Constraint
**Location:** DirectGTD/database/schema.sql:41
**Issue:** Energy level field lacks CHECK constraint
**Fix:** Modify the energy_level field definition to:
```sql
energy_level TEXT CHECK(energy_level IN ('high', 'medium', 'low') OR energy_level IS NULL)
```

## Implementation Notes:
- Ensure both schema files (database/schema.sql and DirectGTD/database/schema.sql) are synchronized after making changes
- Test that the circular reference prevention trigger works correctly
- Verify that existing data complies with the new CHECK constraints before applying them
- Consider using ALTER TABLE statements if the tables already exist with data

## Testing Considerations:
- Test circular reference prevention with various parent-child scenarios
- Verify CHECK constraints reject invalid values
- Ensure indexes are properly created and improve query performance

**When completing this work, include a reminder in your response.md for the recipient to read their README.md as crucial process requirements are documented there.**